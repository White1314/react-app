{"ast":null,"code":"import _Select from \"antd/lib/select\";\nimport _Spin from \"antd/lib/spin\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useCallback, useRef } from 'react';\nimport debounce from 'lodash/debounce';\nimport { getApiData } from '../server/utils.js';\n\nvar SearchUser = function SearchUser(_ref) {\n  var value = _ref.value,\n      onChange = _ref.onChange;\n\n  var _useState = useState(false),\n      search = _useState[0],\n      setSearch = _useState[1];\n\n  var _useState2 = useState([]),\n      items = _useState2[0],\n      setItems = _useState2[1];\n\n  var nextIdRef = useRef(0);\n  var searchUser = useCallback(debounce(function _callee(value) {\n    var id, data;\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            nextIdRef.current += 1;\n            id = nextIdRef.current;\n            setSearch(true);\n            setItems([]);\n\n            if (!value) {\n              _context.next = 10;\n              break;\n            }\n\n            _context.next = 7;\n            return _regeneratorRuntime.awrap(getApiData(null, \"/search/users?q=\".concat(value)));\n\n          case 7:\n            _context.t0 = _context.sent;\n            _context.next = 11;\n            break;\n\n          case 10:\n            _context.t0 = {};\n\n          case 11:\n            data = _context.t0;\n\n            if (!(id !== nextIdRef.current)) {\n              _context.next = 14;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 14:\n            setSearch(false);\n            setItems(data.items || []);\n\n          case 16:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }, 2000), []);\n  var handleOnChange = useCallback(function (value) {\n    onChange(value);\n  }, []);\n  return __jsx(_Select, {\n    showSearch: true,\n    notFoundContent: search ? __jsx(_Spin, {\n      size: \"small\"\n    }) : __jsx(\"span\", null, \"no data\"),\n    filterOption: false,\n    placeholder: \"\\u641C\\u7D22\\u7528\\u6237\",\n    allowClear: true,\n    value: value,\n    onSearch: searchUser,\n    onChange: handleOnChange,\n    style: {\n      width: 150,\n      marginBottom: 20\n    }\n  }, items.map(function (item) {\n    return __jsx(_Select.Option, {\n      value: item.value,\n      key: item.id\n    }, item.login);\n  }));\n};\n\nexport default SearchUser;","map":{"version":3,"sources":["D:/360Downloads/Vscode/program/Next-Github-App/components/SearchUser.tsx"],"names":["useState","useCallback","useRef","debounce","getApiData","SearchUser","value","onChange","search","setSearch","items","setItems","nextIdRef","searchUser","current","id","data","handleOnChange","width","marginBottom","map","item","login"],"mappings":";;;;;AAAA,SAASA,QAAT,EAAmBC,WAAnB,EAAgCC,MAAhC,QAA8C,OAA9C;AAEA,OAAOC,QAAP,MAAqB,iBAArB;AAEA,SAASC,UAAT,QAA2B,oBAA3B;;AAEA,IAAMC,UAAU,GAAG,SAAbA,UAAa,OAAyB;AAAA,MAAtBC,KAAsB,QAAtBA,KAAsB;AAAA,MAAfC,QAAe,QAAfA,QAAe;;AAAA,kBACdP,QAAQ,CAAC,KAAD,CADM;AAAA,MACnCQ,MADmC;AAAA,MAC3BC,SAD2B;;AAAA,mBAEhBT,QAAQ,CAAC,EAAD,CAFQ;AAAA,MAEnCU,KAFmC;AAAA,MAE5BC,QAF4B;;AAG1C,MAAMC,SAAS,GAAGV,MAAM,CAAC,CAAD,CAAxB;AAEA,MAAMW,UAAU,GAAGZ,WAAW,CAC5BE,QAAQ,CAAC,iBAAOG,KAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AACPM,YAAAA,SAAS,CAACE,OAAV,IAAqB,CAArB;AACMC,YAAAA,EAFC,GAEIH,SAAS,CAACE,OAFd;AAGPL,YAAAA,SAAS,CAAC,IAAD,CAAT;AACAE,YAAAA,QAAQ,CAAC,EAAD,CAAR;;AAJO,iBAKML,KALN;AAAA;AAAA;AAAA;;AAAA;AAAA,6CAMGF,UAAU,CAAC,IAAD,4BAA0BE,KAA1B,EANb;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,0BAOH,EAPG;;AAAA;AAKDU,YAAAA,IALC;;AAAA,kBASHD,EAAE,KAAKH,SAAS,CAACE,OATd;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAUPL,YAAAA,SAAS,CAAC,KAAD,CAAT;AACAE,YAAAA,QAAQ,CAACK,IAAI,CAACN,KAAL,IAAc,EAAf,CAAR;;AAXO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAD,EAYL,IAZK,CADoB,EAc5B,EAd4B,CAA9B;AAiBA,MAAMO,cAAc,GAAGhB,WAAW,CAAC,UAACK,KAAD,EAAW;AAC5CC,IAAAA,QAAQ,CAACD,KAAD,CAAR;AACD,GAFiC,EAE/B,EAF+B,CAAlC;AAIA,SACE;AACE,IAAA,UAAU,EAAE,IADd;AAEE,IAAA,eAAe,EAAEE,MAAM,GAAG;AAAM,MAAA,IAAI,EAAC;AAAX,MAAH,GAA2B,8BAFpD;AAGE,IAAA,YAAY,EAAE,KAHhB;AAIE,IAAA,WAAW,EAAC,0BAJd;AAKE,IAAA,UAAU,EAAE,IALd;AAME,IAAA,KAAK,EAAEF,KANT;AAOE,IAAA,QAAQ,EAAEO,UAPZ;AAQE,IAAA,QAAQ,EAAEI,cARZ;AASE,IAAA,KAAK,EAAE;AAAEC,MAAAA,KAAK,EAAE,GAAT;AAAcC,MAAAA,YAAY,EAAE;AAA5B;AATT,KAWGT,KAAK,CAACU,GAAN,CAAU,UAACC,IAAD;AAAA,WACT,cAAQ,MAAR;AAAe,MAAA,KAAK,EAAEA,IAAI,CAACf,KAA3B;AAAkC,MAAA,GAAG,EAAEe,IAAI,CAACN;AAA5C,OACGM,IAAI,CAACC,KADR,CADS;AAAA,GAAV,CAXH,CADF;AAmBD,CA7CD;;AA+CA,eAAejB,UAAf","sourcesContent":["import { useState, useCallback, useRef } from 'react';\r\nimport { Select, Spin } from 'antd';\r\nimport debounce from 'lodash/debounce';\r\n\r\nimport { getApiData } from '../server/utils.js';\r\n\r\nconst SearchUser = ({ value, onChange }) => {\r\n  const [search, setSearch] = useState(false);\r\n  const [items, setItems] = useState([]);\r\n  const nextIdRef = useRef(0);\r\n\r\n  const searchUser = useCallback(\r\n    debounce(async (value: string) => {\r\n      nextIdRef.current += 1;\r\n      const id = nextIdRef.current;\r\n      setSearch(true);\r\n      setItems([]);\r\n      const data = value\r\n        ? await getApiData(null, `/search/users?q=${value}`)\r\n        : {};\r\n      // 不渲染上一次未及时响应的数据\r\n      if (id !== nextIdRef.current) return;\r\n      setSearch(false);\r\n      setItems(data.items || []);\r\n    }, 2000),\r\n    []\r\n  );\r\n\r\n  const handleOnChange = useCallback((value) => {\r\n    onChange(value);\r\n  }, []);\r\n\r\n  return (\r\n    <Select\r\n      showSearch={true}\r\n      notFoundContent={search ? <Spin size=\"small\" /> : <span>no data</span>}\r\n      filterOption={false}\r\n      placeholder=\"搜索用户\"\r\n      allowClear={true}\r\n      value={value}\r\n      onSearch={searchUser}\r\n      onChange={handleOnChange}\r\n      style={{ width: 150, marginBottom: 20 }}\r\n    >\r\n      {items.map((item: any) => (\r\n        <Select.Option value={item.value} key={item.id}>\r\n          {item.login}\r\n        </Select.Option>\r\n      ))}\r\n    </Select>\r\n  );\r\n};\r\n\r\nexport default SearchUser;\r\n"]},"metadata":{},"sourceType":"module"}