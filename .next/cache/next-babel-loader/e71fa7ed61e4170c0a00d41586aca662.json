{"ast":null,"code":"var _regeneratorRuntime = require(\"@babel/runtime/regenerator\");\n\nvar axios = require('axios');\n\nvar atob = require('atob');\n\nglobal.atob = atob;\nvar BASE_URL = 'https://api.github.com';\n\nvar _require = require('../config'),\n    SEARCH_REPOSITY_URL = _require.SEARCH_REPOSITY_URL,\n    USER_REPOSITY_URL = _require.USER_REPOSITY_URL,\n    USER_STAR_URL = _require.USER_STAR_URL,\n    REPOSITY_DETAIL_URL = _require.REPOSITY_DETAIL_URL;\n\nvar _require2 = require('./getPath'),\n    getParamsToString = _require2.getParamsToString,\n    getQueryToSlash = _require2.getQueryToSlash;\n\nvar getApiData = function getApiData(ctx, path) {\n  var url, isServer, headers, result, data, oauth, _ref, token_type, access_token, _result, _data;\n\n  return _regeneratorRuntime.async(function getApiData$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          url = '';\n          _context.t0 = path;\n          _context.next = _context.t0 === '/api/user/repos' ? 4 : _context.t0 === '/api/user/starred' ? 6 : _context.t0 === '/api/search' ? 8 : _context.t0 === '/api/detail/user' ? 10 : _context.t0 === '/api/detail/readme' ? 12 : _context.t0 === '/api/detail/issues' ? 14 : 16;\n          break;\n\n        case 4:\n          url = USER_REPOSITY_URL;\n          return _context.abrupt(\"break\", 17);\n\n        case 6:\n          url = USER_STAR_URL;\n          return _context.abrupt(\"break\", 17);\n\n        case 8:\n          url = SEARCH_REPOSITY_URL + getParamsToString(ctx.query);\n          return _context.abrupt(\"break\", 17);\n\n        case 10:\n          url = REPOSITY_DETAIL_URL + getQueryToSlash(ctx.query);\n          return _context.abrupt(\"break\", 17);\n\n        case 12:\n          url = REPOSITY_DETAIL_URL + getQueryToSlash(ctx.query) + '/readme';\n          return _context.abrupt(\"break\", 17);\n\n        case 14:\n          url = REPOSITY_DETAIL_URL + getQueryToSlash(ctx.query) + '/issues';\n          return _context.abrupt(\"break\", 17);\n\n        case 16:\n          return _context.abrupt(\"break\", 17);\n\n        case 17:\n          // 判断当前为请求环境为服务端还是客户端（网页刷新和链接跳转）\n          isServer = false;\n          headers = {}; // 客户端请求没有 session (ctx.req.session)，需代理到服务器上\n\n          if (isServer) {\n            _context.next = 28;\n            break;\n          }\n\n          // 转发到客户端\n          url = \"api\".concat(path);\n          _context.next = 23;\n          return _regeneratorRuntime.awrap(axios({\n            url: path,\n            method: 'get'\n          }));\n\n        case 23:\n          result = _context.sent;\n          data = result.data.data || [];\n          return _context.abrupt(\"return\", data);\n\n        case 28:\n          url = BASE_URL + path + getParamsToString(ctx.query); // 服务端可直接获取 session\n\n          oauth = ctx.req.session.oauth;\n          _ref = oauth ? oauth : {}, token_type = _ref.token_type, access_token = _ref.access_token;\n          headers = oauth ? {\n            Authorization: \"\".concat(token_type, \" \").concat(access_token)\n          } : {};\n          _context.next = 34;\n          return _regeneratorRuntime.awrap(axios({\n            url: url,\n            method: 'get',\n            headers: headers\n          })[\"catch\"](function (err) {}));\n\n        case 34:\n          _result = _context.sent;\n          console.log('服务端获取数据成功');\n          _data = _result ? _result.data : [];\n          return _context.abrupt(\"return\", _data);\n\n        case 38:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, null, Promise);\n};\n\nmodule.exports = {\n  getApiData: getApiData\n};","map":{"version":3,"sources":["D:/360Downloads/Vscode/program/Next-Github-App/server/utils.js"],"names":["axios","require","atob","global","BASE_URL","SEARCH_REPOSITY_URL","USER_REPOSITY_URL","USER_STAR_URL","REPOSITY_DETAIL_URL","getParamsToString","getQueryToSlash","getApiData","ctx","path","url","query","isServer","headers","method","result","data","oauth","req","session","token_type","access_token","Authorization","err","console","log","module","exports"],"mappings":"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","sourcesContent":["const axios = require('axios');\r\nconst atob = require('atob');\r\n\r\nglobal.atob = atob;\r\n\r\nconst BASE_URL = 'https://api.github.com';\r\n\r\nconst {\r\n  SEARCH_REPOSITY_URL,\r\n  USER_REPOSITY_URL,\r\n  USER_STAR_URL,\r\n  REPOSITY_DETAIL_URL,\r\n} = require('../config');\r\n\r\nconst { getParamsToString, getQueryToSlash } = require('./getPath');\r\n\r\nconst getApiData = async (ctx, path) => {\r\n  let url = '';\r\n  switch (path) {\r\n    case '/api/user/repos':\r\n      url = USER_REPOSITY_URL;\r\n      break;\r\n    case '/api/user/starred':\r\n      url = USER_STAR_URL;\r\n      break;\r\n    case '/api/search':\r\n      url = SEARCH_REPOSITY_URL + getParamsToString(ctx.query);\r\n      break;\r\n    case '/api/detail/user':\r\n      url = REPOSITY_DETAIL_URL + getQueryToSlash(ctx.query);\r\n      break;\r\n    case '/api/detail/readme':\r\n      url = REPOSITY_DETAIL_URL + getQueryToSlash(ctx.query) + '/readme';\r\n      break;\r\n    case '/api/detail/issues':\r\n      url = REPOSITY_DETAIL_URL + getQueryToSlash(ctx.query) + '/issues';\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n\r\n  // 判断当前为请求环境为服务端还是客户端（网页刷新和链接跳转）\r\n  let isServer = typeof window === 'undefined';\r\n  let headers = {};\r\n\r\n  // 客户端请求没有 session (ctx.req.session)，需代理到服务器上\r\n  if (!isServer) {\r\n    // 转发到客户端\r\n    url = `api${path}`;\r\n    const result = await axios({ url: path, method: 'get' });\r\n    let data = result.data.data || [];\r\n    return data;\r\n  } else {\r\n    url = BASE_URL + path + getParamsToString(ctx.query);\r\n    // 服务端可直接获取 session\r\n    const { oauth } = ctx.req.session;\r\n    const { token_type, access_token } = oauth ? oauth : {};\r\n    headers = oauth\r\n      ? {\r\n          Authorization: `${token_type} ${access_token}`,\r\n        }\r\n      : {};\r\n    const result = await axios({\r\n      url,\r\n      method: 'get',\r\n      headers,\r\n    }).catch((err) => {});\r\n    console.log('服务端获取数据成功');\r\n    let data = result ? result.data : [];\r\n    return data;\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  getApiData,\r\n};\r\n"]},"metadata":{},"sourceType":"script"}