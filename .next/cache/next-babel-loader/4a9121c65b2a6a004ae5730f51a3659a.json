{"ast":null,"code":"var _regeneratorRuntime = require(\"@babel/runtime/regenerator\");\n\nvar axios = require('axios');\n\nvar _require = require('../config'),\n    REPOSITY_URL = _require.REPOSITY_URL,\n    USER_REPOSITY_URL = _require.USER_REPOSITY_URL,\n    USER_STAR_URL = _require.USER_STAR_URL;\n\nvar successInfo = function successInfo(msg, data) {\n  return {\n    code: 0,\n    msg: msg,\n    data: data\n  };\n};\n\nvar getApiData = function getApiData(ctx, path) {\n  var url, params, _ctx$query, q, lang, sort, order, isServer, headers, _url, result, data, oauth, _ref, token_type, access_token, _result, _data;\n\n  return _regeneratorRuntime.async(function getApiData$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          url = '';\n          params = {}; // 根据客户端请求的 path 匹配对应的 github api url\n\n          _context.t0 = path;\n          _context.next = _context.t0 === '/api/user/repos' ? 5 : _context.t0 === '/api/user/starred' ? 7 : _context.t0 === '/api/search' ? 9 : 12;\n          break;\n\n        case 5:\n          url = USER_REPOSITY_URL;\n          return _context.abrupt(\"break\", 13);\n\n        case 7:\n          url = USER_STAR_URL;\n          return _context.abrupt(\"break\", 13);\n\n        case 9:\n          _ctx$query = ctx.query, q = _ctx$query.q, lang = _ctx$query.lang, sort = _ctx$query.sort, order = _ctx$query.order;\n          params = {\n            q: q,\n            lang: lang,\n            sort: sort,\n            order: order\n          };\n          url = REPOSITY_URL;\n\n        case 12:\n          return _context.abrupt(\"break\", 13);\n\n        case 13:\n          // 判断当前为请求环境为服务端还是客户端（网页刷新和链接跳转）\n          isServer = false;\n          headers = {}; // 客户端请求没有 req\n\n          if (isServer) {\n            _context.next = 25;\n            break;\n          }\n\n          console.log(ctx); // ctx.asPath = search?q=&lang=JavaScript&sort=&order=\n\n          _url = '/api' + ctx.asPath; // 代理到服务端\n\n          _context.next = 20;\n          return _regeneratorRuntime.awrap(axios({\n            url: _url,\n            method: 'get'\n          }));\n\n        case 20:\n          result = _context.sent;\n          data = result ? result.data : [];\n          return _context.abrupt(\"return\", data);\n\n        case 25:\n          // 服务端可直接获取 ctx\n          oauth = ctx.req.session.oauth;\n          _ref = oauth ? oauth : {}, token_type = _ref.token_type, access_token = _ref.access_token;\n          headers = oauth ? {\n            Authorization: \"\".concat(token_type, \" \").concat(access_token)\n          } : {};\n          _context.next = 30;\n          return _regeneratorRuntime.awrap(axios({\n            url: url,\n            method: 'get',\n            params: params,\n            headers: headers\n          })[\"catch\"](function (err) {}));\n\n        case 30:\n          _result = _context.sent;\n          console.log('服务端获取数据成功');\n          _data = _result ? _result.data : [];\n          ctx.body = successInfo('服务端获取数据成功', _data);\n\n        case 34:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, null, Promise);\n};\n\nmodule.exports = {\n  getApiData: getApiData\n};","map":{"version":3,"sources":["D:/360Downloads/Vscode/program/Next-Github-App/server/utils.js"],"names":["axios","require","REPOSITY_URL","USER_REPOSITY_URL","USER_STAR_URL","successInfo","msg","data","code","getApiData","ctx","path","url","params","query","q","lang","sort","order","isServer","headers","console","log","asPath","method","result","oauth","req","session","token_type","access_token","Authorization","err","body","module","exports"],"mappings":"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","sourcesContent":["const axios = require('axios');\r\n\r\nconst { REPOSITY_URL, USER_REPOSITY_URL, USER_STAR_URL } = require('../config');\r\nconst successInfo = (msg, data) => ({ code: 0, msg, data });\r\n\r\nconst getApiData = async (ctx, path) => {\r\n  let url = '';\r\n  let params = {};\r\n  // 根据客户端请求的 path 匹配对应的 github api url\r\n  switch (path) {\r\n    case '/api/user/repos':\r\n      url = USER_REPOSITY_URL;\r\n      break;\r\n    case '/api/user/starred':\r\n      url = USER_STAR_URL;\r\n      break;\r\n    case '/api/search':\r\n      let { q, lang, sort, order } = ctx.query;\r\n      params = { q, lang, sort, order };\r\n      url = REPOSITY_URL;\r\n    default:\r\n      break;\r\n  }\r\n\r\n  // 判断当前为请求环境为服务端还是客户端（网页刷新和链接跳转）\r\n  let isServer = typeof window === 'undefined';\r\n  let headers = {};\r\n\r\n  // 客户端请求没有 req\r\n  if (!isServer) {\r\n    console.log(ctx);\r\n    // ctx.asPath = search?q=&lang=JavaScript&sort=&order=\r\n    const url = '/api' + ctx.asPath;\r\n    // 代理到服务端\r\n    const result = await axios({ url, method: 'get' });\r\n    let data = result ? result.data : [];\r\n    return data;\r\n  } else {\r\n    // 服务端可直接获取 ctx\r\n    const { oauth } = ctx.req.session;\r\n    const { token_type, access_token } = oauth ? oauth : {};\r\n    headers = oauth\r\n      ? {\r\n          Authorization: `${token_type} ${access_token}`,\r\n        }\r\n      : {};\r\n    const result = await axios({\r\n      url,\r\n      method: 'get',\r\n      params,\r\n      headers,\r\n    }).catch((err) => {});\r\n    console.log('服务端获取数据成功');\r\n    let data = result ? result.data : [];\r\n    ctx.body = successInfo('服务端获取数据成功', data);\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  getApiData,\r\n};\r\n"]},"metadata":{},"sourceType":"script"}