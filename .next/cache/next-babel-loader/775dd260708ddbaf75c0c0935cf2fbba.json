{"ast":null,"code":"const axios = require('axios');\n\nconst atob = require('atob');\n\nglobal.atob = atob;\nconst BASE_URL = 'https://api.github.com';\n\nconst {\n  SEARCH_REPOSITY_URL,\n  USER_REPOSITY_URL,\n  USER_STAR_URL,\n  REPOSITY_DETAIL_URL\n} = require('../config');\n\nconst {\n  getParamsToString,\n  getQueryToSlash\n} = require('./getPath');\n\nconst getApiData = async (ctx, path) => {\n  let url = '';\n  console.log(ctx.path);\n  console.log(ctx.url);\n  url = ctx.path + getParamsToString(ctx.query);\n  console.log(url);\n\n  switch (path) {\n    case '/api/user/repos':\n      url = USER_REPOSITY_URL;\n      break;\n\n    case '/api/user/starred':\n      url = USER_STAR_URL;\n      break;\n\n    case '/api/search':\n      url = SEARCH_REPOSITY_URL + getParamsToString(ctx.query);\n      break;\n\n    case '/api/detail/user':\n      url = REPOSITY_DETAIL_URL + getQueryToSlash(ctx.query);\n      break;\n\n    case '/api/detail/readme':\n      url = REPOSITY_DETAIL_URL + getQueryToSlash(ctx.query) + '/readme';\n      break;\n\n    case '/api/detail/issues':\n      url = REPOSITY_DETAIL_URL + getQueryToSlash(ctx.query) + '/issues';\n      break;\n\n    default:\n      break;\n  } // 判断当前为请求环境为服务端还是客户端（网页刷新和链接跳转）\n\n\n  let isServer = true;\n  let headers = {}; // 客户端请求没有 ctx.session (ctx.req.session)，需代理到服务器上\n\n  if (!isServer) {\n    console.log(ctx); // ctx.asPath = search?q=&lang=JavaScript&sort=&order=\n\n    let path = '/api' + ctx.asPath;\n    const result = await axios({\n      url: path,\n      method: 'get'\n    });\n    console.log(result);\n    let data = result.data.code === 0 ? result.data.data : [];\n    return data;\n  } else {\n    // 服务端可直接获取 ctx\n    url = p;\n    const {\n      oauth\n    } = ctx.req.session;\n    const {\n      token_type,\n      access_token\n    } = oauth ? oauth : {};\n    headers = oauth ? {\n      Authorization: `${token_type} ${access_token}`\n    } : {};\n    const result = await axios({\n      url,\n      method: 'get',\n      headers\n    }).catch(err => {});\n    console.log('服务端获取数据成功');\n    let data = result ? result.data : [];\n    return data;\n  }\n};\n\nmodule.exports = {\n  getApiData\n};","map":{"version":3,"sources":["D:/360Downloads/Vscode/program/Next-Github-App/server/utils.js"],"names":["axios","require","atob","global","BASE_URL","SEARCH_REPOSITY_URL","USER_REPOSITY_URL","USER_STAR_URL","REPOSITY_DETAIL_URL","getParamsToString","getQueryToSlash","getApiData","ctx","path","url","console","log","query","isServer","headers","asPath","result","method","data","code","p","oauth","req","session","token_type","access_token","Authorization","catch","err","module","exports"],"mappings":"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","sourcesContent":["const axios = require('axios');\r\nconst atob = require('atob');\r\n\r\nglobal.atob = atob;\r\n\r\nconst BASE_URL = 'https://api.github.com';\r\n\r\nconst {\r\n  SEARCH_REPOSITY_URL,\r\n  USER_REPOSITY_URL,\r\n  USER_STAR_URL,\r\n  REPOSITY_DETAIL_URL,\r\n} = require('../config');\r\n\r\nconst { getParamsToString, getQueryToSlash } = require('./getPath');\r\n\r\nconst getApiData = async (ctx, path) => {\r\n  let url = '';\r\n  console.log(ctx.path);\r\n  console.log(ctx.url);\r\n  url = ctx.path + getParamsToString(ctx.query);\r\n  console.log(url);\r\n  switch (path) {\r\n    case '/api/user/repos':\r\n      url = USER_REPOSITY_URL;\r\n      break;\r\n    case '/api/user/starred':\r\n      url = USER_STAR_URL;\r\n      break;\r\n    case '/api/search':\r\n      url = SEARCH_REPOSITY_URL + getParamsToString(ctx.query);\r\n      break;\r\n    case '/api/detail/user':\r\n      url = REPOSITY_DETAIL_URL + getQueryToSlash(ctx.query);\r\n      break;\r\n    case '/api/detail/readme':\r\n      url = REPOSITY_DETAIL_URL + getQueryToSlash(ctx.query) + '/readme';\r\n      break;\r\n    case '/api/detail/issues':\r\n      url = REPOSITY_DETAIL_URL + getQueryToSlash(ctx.query) + '/issues';\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n\r\n  // 判断当前为请求环境为服务端还是客户端（网页刷新和链接跳转）\r\n  let isServer = typeof window === 'undefined';\r\n  let headers = {};\r\n\r\n  // 客户端请求没有 ctx.session (ctx.req.session)，需代理到服务器上\r\n  if (!isServer) {\r\n    console.log(ctx);\r\n    // ctx.asPath = search?q=&lang=JavaScript&sort=&order=\r\n    let path = '/api' + ctx.asPath;\r\n    const result = await axios({ url: path, method: 'get' });\r\n    console.log(result);\r\n    let data = result.data.code === 0 ? result.data.data : [];\r\n    return data;\r\n  } else {\r\n    // 服务端可直接获取 ctx\r\n    url = p;\r\n    const { oauth } = ctx.req.session;\r\n    const { token_type, access_token } = oauth ? oauth : {};\r\n    headers = oauth\r\n      ? {\r\n          Authorization: `${token_type} ${access_token}`,\r\n        }\r\n      : {};\r\n    const result = await axios({\r\n      url,\r\n      method: 'get',\r\n      headers,\r\n    }).catch((err) => {});\r\n    console.log('服务端获取数据成功');\r\n    let data = result ? result.data : [];\r\n    return data;\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  getApiData,\r\n};\r\n"]},"metadata":{},"sourceType":"script"}