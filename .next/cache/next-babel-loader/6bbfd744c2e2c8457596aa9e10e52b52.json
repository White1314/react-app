{"ast":null,"code":"const axios = require('axios');\n\nconst {\n  REPOSITY_URL,\n  USER_REPOSITY_URL,\n  USER_STAR_URL\n} = require('../config');\n\nconst getApiData = async (ctx, path) => {\n  let url = '';\n  let params = {}; // 根据客户端请求的 path 匹配对应的 github api url\n\n  switch (path) {\n    case '/api/user/repos':\n      url = USER_REPOSITY_URL;\n      break;\n\n    case '/api/user/starred':\n      url = USER_STAR_URL;\n      break;\n\n    case '/api/search/repo':\n      let {\n        q,\n        lang,\n        sort,\n        order\n      } = ctx.query;\n      params = {\n        q,\n        lang,\n        sort,\n        order\n      };\n      url = REPOSITY_URL;\n\n    default:\n      break;\n  } // 判断当前为请求环境为服务端还是客户端（网页刷新和链接跳转）\n\n\n  let isServer = true;\n  let headers = {}; // 客户端请求没有 req，需代理到服务器上\n\n  if (!isServer) {\n    console.log(ctx);\n    const url = 'api' + ctx.asPath;\n    const result = await axios({\n      url,\n      method: 'get'\n    });\n    console.log(result);\n    ctx.body = [];\n    return;\n  } // 服务端可直接获取 ctx\n\n\n  const {\n    oauth\n  } = ctx.req.session;\n  const {\n    token_type,\n    access_token\n  } = oauth ? oauth : {};\n  headers = oauth ? {\n    Authorization: `${token_type} ${access_token}`\n  } : {};\n  const result = await axios({\n    url,\n    method: 'get',\n    params,\n    headers\n  }).catch(err => {});\n  console.log('get result');\n  let data = result ? result.data : [];\n  return data;\n};\n\nmodule.exports = {\n  getApiData\n};","map":{"version":3,"sources":["D:/360Downloads/Vscode/program/Next-Github-App/server/utils.js"],"names":["axios","require","REPOSITY_URL","USER_REPOSITY_URL","USER_STAR_URL","getApiData","ctx","path","url","params","q","lang","sort","order","query","isServer","headers","console","log","asPath","result","method","body","oauth","req","session","token_type","access_token","Authorization","catch","err","data","module","exports"],"mappings":"AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAArB;;AACA,MAAM;AAAEC,EAAAA,YAAF;AAAgBC,EAAAA,iBAAhB;AAAmCC,EAAAA;AAAnC,IAAqDH,OAAO,CAAC,WAAD,CAAlE;;AAEA,MAAMI,UAAU,GAAG,OAAOC,GAAP,EAAYC,IAAZ,KAAqB;AACtC,MAAIC,GAAG,GAAG,EAAV;AACA,MAAIC,MAAM,GAAG,EAAb,CAFsC,CAGtC;;AACA,UAAQF,IAAR;AACE,SAAK,iBAAL;AACEC,MAAAA,GAAG,GAAGL,iBAAN;AACA;;AACF,SAAK,mBAAL;AACEK,MAAAA,GAAG,GAAGJ,aAAN;AACA;;AACF,SAAK,kBAAL;AACE,UAAI;AAAEM,QAAAA,CAAF;AAAKC,QAAAA,IAAL;AAAWC,QAAAA,IAAX;AAAiBC,QAAAA;AAAjB,UAA2BP,GAAG,CAACQ,KAAnC;AACAL,MAAAA,MAAM,GAAG;AAAEC,QAAAA,CAAF;AAAKC,QAAAA,IAAL;AAAWC,QAAAA,IAAX;AAAiBC,QAAAA;AAAjB,OAAT;AACAL,MAAAA,GAAG,GAAGN,YAAN;;AACF;AACE;AAZJ,GAJsC,CAmBtC;;;AACA,MAAIa,QAAQ,OAAZ;AACA,MAAIC,OAAO,GAAG,EAAd,CArBsC,CAuBtC;;AACA,MAAI,CAACD,QAAL,EAAe;AACbE,IAAAA,OAAO,CAACC,GAAR,CAAYZ,GAAZ;AACA,UAAME,GAAG,GAAG,QAAQF,GAAG,CAACa,MAAxB;AACA,UAAMC,MAAM,GAAG,MAAMpB,KAAK,CAAC;AAAEQ,MAAAA,GAAF;AAAOa,MAAAA,MAAM,EAAE;AAAf,KAAD,CAA1B;AACAJ,IAAAA,OAAO,CAACC,GAAR,CAAYE,MAAZ;AACAd,IAAAA,GAAG,CAACgB,IAAJ,GAAW,EAAX;AACA;AACD,GA/BqC,CAiCtC;;;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAYjB,GAAG,CAACkB,GAAJ,CAAQC,OAA1B;AACA,QAAM;AAAEC,IAAAA,UAAF;AAAcC,IAAAA;AAAd,MAA+BJ,KAAK,GAAGA,KAAH,GAAW,EAArD;AACAP,EAAAA,OAAO,GAAGO,KAAK,GACX;AACEK,IAAAA,aAAa,EAAG,GAAEF,UAAW,IAAGC,YAAa;AAD/C,GADW,GAIX,EAJJ;AAKA,QAAMP,MAAM,GAAG,MAAMpB,KAAK,CAAC;AACzBQ,IAAAA,GADyB;AAEzBa,IAAAA,MAAM,EAAE,KAFiB;AAGzBZ,IAAAA,MAHyB;AAIzBO,IAAAA;AAJyB,GAAD,CAAL,CAKlBa,KALkB,CAKXC,GAAD,IAAS,CAAE,CALC,CAArB;AAMAb,EAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACA,MAAIa,IAAI,GAAGX,MAAM,GAAGA,MAAM,CAACW,IAAV,GAAiB,EAAlC;AACA,SAAOA,IAAP;AACD,CAlDD;;AAoDAC,MAAM,CAACC,OAAP,GAAiB;AACf5B,EAAAA;AADe,CAAjB","sourcesContent":["const axios = require('axios');\r\nconst { REPOSITY_URL, USER_REPOSITY_URL, USER_STAR_URL } = require('../config');\r\n\r\nconst getApiData = async (ctx, path) => {\r\n  let url = '';\r\n  let params = {};\r\n  // 根据客户端请求的 path 匹配对应的 github api url\r\n  switch (path) {\r\n    case '/api/user/repos':\r\n      url = USER_REPOSITY_URL;\r\n      break;\r\n    case '/api/user/starred':\r\n      url = USER_STAR_URL;\r\n      break;\r\n    case '/api/search/repo':\r\n      let { q, lang, sort, order } = ctx.query;\r\n      params = { q, lang, sort, order };\r\n      url = REPOSITY_URL;\r\n    default:\r\n      break;\r\n  }\r\n\r\n  // 判断当前为请求环境为服务端还是客户端（网页刷新和链接跳转）\r\n  let isServer = typeof window === 'undefined';\r\n  let headers = {};\r\n\r\n  // 客户端请求没有 req，需代理到服务器上\r\n  if (!isServer) {\r\n    console.log(ctx);\r\n    const url = 'api' + ctx.asPath;\r\n    const result = await axios({ url, method: 'get' });\r\n    console.log(result);\r\n    ctx.body = [];\r\n    return;\r\n  }\r\n\r\n  // 服务端可直接获取 ctx\r\n  const { oauth } = ctx.req.session;\r\n  const { token_type, access_token } = oauth ? oauth : {};\r\n  headers = oauth\r\n    ? {\r\n        Authorization: `${token_type} ${access_token}`,\r\n      }\r\n    : {};\r\n  const result = await axios({\r\n    url,\r\n    method: 'get',\r\n    params,\r\n    headers,\r\n  }).catch((err) => {});\r\n  console.log('get result');\r\n  let data = result ? result.data : [];\r\n  return data;\r\n};\r\n\r\nmodule.exports = {\r\n  getApiData,\r\n};\r\n"]},"metadata":{},"sourceType":"script"}